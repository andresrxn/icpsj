---
import { cn } from '@/utils/theme'
import type { HTMLAttributes } from 'astro/types'
import { cva, type VariantProps } from 'class-variance-authority'
import { ChevronRight, Download, ExternalLink } from 'lucide-astro'

export const linkVariants = cva(
  'underline-offset-2 focus-visible:outline-2 focus-visible:outline-focus inline-flex text-body-inherit text-inherit',
  {
    variants: {
      full: {
        true: 'text-center w-full lg:text-body-lg text-body-base'
      },
      wrapper: {
        true: 'text-inherit decoration-none',
        false: 'decoration underline lg:no-underline lg:hover:underline'
      },
      icon: {
        true: 'text-center items-center justify-center gap-4 group'
      },
      variant: {
        base: 'text-base active:opacity-75',
        primary: 'text-link-base active:text-link-base-active',
        inverted: 'text-base-inverted-fixed active:opacity-75'
      },
      selectable: {
        true: 'text-selectable hover:text-selectable-hover'
      },
      selected: {
        true: 'text-selected hover:text-selected'
      }
    },
    compoundVariants: [
      {
        variant: 'inverted',
        selected: true,
        class: 'text-selected-inverted'
      },
      {
        variant: 'base',
        selected: true,
        class: 'font-semibold text-selected-base'
      }
    ],
    defaultVariants: {
      wrapper: false,
      full: false,
      icon: false,
      variant: 'primary',
      selectable: false,
      selected: false
    }
  }
)

export interface Props extends HTMLAttributes<'a'>, VariantProps<typeof linkVariants> {
  href: string
  target?: '_self' | '_blank' | '_parent' | '_top'
}

const {
  href,
  target,
  icon,
  full,
  download,
  wrapper,
  variant = wrapper ? 'base' : 'primary',
  selectable,
  selected,
  class: className,
  ...props
} = Astro.props
---

<a
  target={target}
  rel={target === '_blank' ? 'noopener noreferrer' : null}
  href={href}
  class={cn(linkVariants({ full, icon, variant, wrapper, selected, selectable }), className)}
  {...props}>
  <slot />
  {
    icon && download && (
      <Download
        class={`size-icon-responsive shrink-0 ${variant === 'primary' ? 'text-icon-info' : 'text-inherit'}`}
      />
    )
  }
  {
    icon && target !== '_blank' && !download ? (
      <ChevronRight
        class={`size-icon-responsive group-hover:translate-x-4  shrink-0 transition-transform ease-base duration-base ${variant === 'primary' ? 'text-icon-info' : 'text-inherit'}`}
      />
    ) : (
      icon &&
      target === '_blank' &&
      !download && (
        <ExternalLink
          class={`size-icon-responsive shrink-0 ${variant === 'primary' ? 'text-icon-info' : 'text-inherit'}`}
        />
      )
    )
  }
</a>
